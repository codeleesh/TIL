# [Unit Testing] 2장 단위 테스트란 무엇인가

이 내용은 ` 단위 테스트 생산성과 품질을 위한 단위 테스트 원칙과 패턴` 를 읽으면서 정리한 내용을 포함하고 있습니다.



단위테스트에 접근하는 방법에 대해서 두 가지의 뚜렷한 견해로 나뉘게 되었습니다. 각각 `고전파` 와 `런던파` 로 알려져 있습니다. 자세한 내용을 알아보도록 하겠습니다.



## 단위테스트의 정의

단위테스트는 3가지 주요 속성이 있습니다.

- 작은 코드 조각을 검증
- 빠르게 수행
- 격리된 방식으로 처리하는 자동화된 테스트



3번째 속성인 격리 문제에 대해서 단위테스트의 고전파와 런던파를 구분할 수 있게 나뉘게 됩니다.

그럼, 코드 조각을 격리된 방식으로 검증한다는 것은 무엇을 의미하는 것일까? 각 분파의 특성과 함께 예제 소스로 알아보도록 하겠습니다.



### 격리 문제에 대한 각 분파 접근



#### 런던파의 접근

런던파에서는 테스트 대상 시스템을 협력자에게서 격리하는 것을 말합니다. 즉 하나의 클래스가 다른 클래스 또는 여러 클래스에 의존하면 이 모든 의존성을 테스트 대역으로 대체해야 합니다. 특징은 다음과 같습니다.

- 동작을 외부 영향과 분리해서 테스트 대상 클래스에만 집중할 수 있습니다.
- 테스트가 실패하면 코드베이스의 어느 부분이 고장 났는지 확실히 알 수 있다는 것입니다.



의존성을 가진 코드베이스를 테스트하는 것은 테스트 대역 없이는 어렵습니다. 의존하는 클래스의 수가 너무 많으면 어려운 작업이 됩니다.

테스트 대역을 사용하면 클래스의 직접적인 의존성을 대체할 수 있고, 더 나아가 의존성의 의존성을 다룰 필요도 없습니다.



#### 고전파의 접근

고전파에서는 코드를 꼭 격리하는 방식으로 테스트해야 하는 것은 아닙니다. 대신 단위 테스트는 서로 격리해서 실행해야 합니다. 이렇게 하면 테스트를 어떤 순서로든 가장 적합한 방식으로 실행할 수 있으며 서로의 결과에 영향을 미치지 않습니다.

각각의 테스트를 격리하는 것은 여러 클래스가 모두 메모리에 상주하고 공유 상태에 도달하지 않는 한, 여러 클래스를 한 번에 테스트해도 괜찮다는 뜻입니다. 이를 통해 테스트가 서로 소통하고 실행 컨텍스트에 영향을 줄 수 있습니다. 데이터베이스, 파일 시스템 등 프로세스 외부 의존성이 이러한 공유 상태의 대표적인 예입니다.



#### 공유 의존성, 비공개 의존성, 프로세스 외부 의존성

공유 의존성

- 테스트 간에 공유되고 서로의 결과에 영향을 미칠 수 있는 수단을 제공하는 의존성
- 예로 정적 가변 필드로 이러한 필드의 변경 사항은 동일한 프로세스 내에서 실행되는 모든 단위 테스트에서 볼 수 있습니다.
- 데이터베이스도 공유 의존성의 전형적인 예가 될 수 있습니다.

비공개 의존성

- 공유하지 않는 의존성

프로세스 외부 의존성

- 애플리케이션 실행 프로세스 외부에서 실행되는 의존성이며, 아직 메모리에 없는 데이터에 대한 프록시입니다.
- 공유 의존성에 해당하지만 모두 그런 것은 아닙니다.
- 예를 들어, 데이터베이스는 프로세스 외부이면서 공유 의존성입니다.
  - 각 테스트 실행 전에 도커 컨테이너로 데이터베이스를 시작하면 테스트가 더 이상 동일한 인스턴스로 작동하지 않기 때문에 프로세스 외부이면서 공유하지 않는 의존성이 됩니다.
  - 데이터베이스 환경에서는 테스트가 데이터를 변경할 수 없으므로 결과에 서로 영향을 미칠 수 없습니다.



### 개발 환경





### 고전파 예시

Store, Customer

