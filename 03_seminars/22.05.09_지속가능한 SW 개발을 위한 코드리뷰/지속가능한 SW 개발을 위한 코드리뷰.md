# 지속가능한 SW 개발을 위한 코드리뷰



## 목차

- 왜 코드 리뷰를 해야 하나 ?
  - 우리가 살고 있는 시대
  - 개발생산성 / SW 공학의 특성 / 장인정신
  - 코드 리뷰의 정의 / 목적
- 코드 리뷰의 절차
- 왜 코드 리뷰가 어려운가
- 기법들
  - 효율적인 PR 방법
  - 효율적인 리뷰 방법
  - 피드백 방법
  - 교착상태 시
  - 추가적인 사례
  - 코드 리뷰를 하는 아주 재밌는 방법





## 왜 코드 리뷰를 해야 하나 ?



### 우리가 살고 있는 시대

- "Software is eating the world"
- Borders vs Amazon, Netflix vs Blockbuster
- 2016 4차산업(세계 경제 포럼)
  - VUCA란? 
    - Volatily(변동성) - 가장 큰 것 
    - Uncertainty(불확실성)
    - Complexity(복잡성)
    - Ambiguity(모호성)

다 정확한 것은 없고 계획하기도 어렵지만 변동성의 비율이 가장 크다고 느껴짐

변동성으로 인하여 우리가 알려진 방법을 풀 수 있는 방법이 줄어들고 있음

변동성 때문에 여러 사람이 협업을 통해서, 협력을 가지고 문제를 해결해야 하는 가치가 높아지고 있음

코드 리부가 변동성을 해결하는데 도움을 주는 방법 중의 하나



- Global GDP에서 Teck의 비율
  - 2020: 5% -> 2030: 10%
  - 주목할 만한 것은 나머지 90%. DT는 이제 시작임
- 지난 2년 동안 Non-Tech 영역에서 개발자 수 증가속도가 Tech 영역에서보다 가파름

- 비즈니스 성공을 위한 개발의 역할
  - 시장 : VUCA
  - 비즈니스 : 더 빨리 혁신해야 함
  - 개발 : DRFR (Deliver SW Rapidly, Frequently and more Reliably)
    - 단순히 CI/CD만의 문제는 아님
- 개발 조직의 성능(생산성)이 중요해짐



### 개발 생산성

클린아키텍처1장 참고



### SW 공학의 특성

#### 기존 공학

- 공학 = 설계(Design) + 빌드(Build)
  - 설계 : 예측하기 어렵고, 급여가 비싸고 창의적인 사람들을 필요
  - 빌드 : 좀 더 예측하기 쉬움
- 설계와 빌드가 분리됨
- 빌드 비용이 비용(건축 90%)
- 유지보수 비용이 상대적으로 낮음



#### SW 공학

- 공학 활동의 최종 목적
  - 빌드할 수 있는 어떤 종류의 재생산 가능한(Reproducible) 문서
- SW 공학의 설계와 빌드
  - 설계 = 완전한 소스 코드
  - SW 빌드 = 컴파일
- 좋은 설계 ~= 클린코드
- SW 엔지니어 : 설계를 잘하는 사람 -> 코드를 잘 작성하는 사람



#### 클린 코드의 중요성

- SW의 진정한 비용 ~= 유지보수(전체의 80% 이상)
- 한번 작성한 코드는 10번 이상 읽음. 작성보다 이해에 10배의 노력 소요
- 90% 이상의 시간을 어떤 코드를 이해하는데 사용함



2주전에 작성한 나의 코드도 2주후에 보면 남이 작성한 코드처럼 보여진다.



### SW 공학의 특성

- SW 개발의 단순한 진리
  - "The only way to go fast, is to go well" - Robert C. Martin
  - 시간이 흘러도 생산성 저하, 비용 증가를 막을 수 있는 유일한 방법
- SW 품질에 신중해야
  - SW의 비용과 품질의 관계는 비정상적, 비직관적
  - 향후 변경 비용을 낮춤으로써 익숙한 트레이드오프를 역전시킴
    - 높은 품질의 제품을 비싸다?
  - 개발자의 전문가 정신 ? 비즈니스 혁신 ?



이번에만 설계의 노력을 덜 들이고 빨리 만들어야겠다?

좋은 설계란 개발자들에게만 도움이 되고 실제 사업에는 도움이 되지 않는다?

우린 지저분한 코드를 용납할 수 없어서 우리에게 개발을 할 수 있는 시간이 많이 필요하다?

테스트 커버리지를 높이고 싶어요?



=> 비즈니스쪽에서 원하는 대답을 드릴 수 있도록



### SW 장인정신

- 애자일
  - VUCA 시대에 더 좋은 SW 개발 방법론
  - 단순 절차 변경 ? 개발 역량 ?
- 장인정신
  - 지식과 경험의 공유 만이 전문성을 갖춘 개발자 육성
  - 후배들에게 지식과 경험을 공유(도제관계)
- 코드 리뷰
  - 개발자가 지금부터 당장 핼할 수 있는 공유 활동
  - Code SNS 댓글 놀이
  - 배움을 주고 받으며 지속가능한 SW 개발자가 될 수 있는 실천법



### 정의 

위키피디아 내용 확인



### 목적

- 주목적 : 품질 문제 검수(버그, 장애)
- 더 나은 코드 품질 : 아키텍처 속성 개선을 위한 코드 개선(향후 변경 비용 개선)
- 학습 및 지식 전달 : 코드, 해결책 등과 관련된 지식 공유에 기여
  - 공유(주고 받는 학습)를 통한 역량 증대 및 성장
    - 대개의 경우 리뷰어들도 리뷰 과정에서 지식을 얻게 됨(하드스킬, 소프트스킬)
  - 동기부여
- 상호 책임감 증대
  - 집단 코드 오너십 및 결속 증대
  - 내가 하고 있는 일에 관심을 가져주는 것
  - 팀에서 일어나는 일 공유. 내 동료는 무엇을 하나 ? 팀웍
- 설계 개선 제안
- 개발 문화 개선



## 코드 리뷰의 절차

- 저자(Author)
  - 코드 작성, 리뷰 요청
- 리뷰어
  - 코드를 읽고
  - 머지 가능한지 결정
- 변경 내역(Change List, PR)
  - 리뷰 시작 전에 작성
  - 저자가 머지를 원하는 소스 코드에 대한 일련의 변경(잘한 것, 아쉬운 것, 눈여겨 볼 것)에 대해 기술



### 좋은 Pull Request 예

- 저자가 고생해서 리뷰어의 시간을 아껴줘야 한다.
  - 저자가 고생하면 코드 리뷰 하는 시간을 많이 절약할 수 있다.
- 모든 산출물(생산물)은 소비자를 위한 것이다. 코드 리뷰는 리뷰어를 위해서 작성하는 것이 중요하다.



[ELSA-310] SpaceNo field 추가 및 생성로직 개선

Description
- SpaceNo field 추가 및 생성로직 개선

How to Test

```
BRANCH=feature/ELSA-310; git fetch origin $BRANCH && git checkout $BRANCH
```

Commits

- FactorySupport 추가
- long createDomainSequenceNoOfUser : currentTimeMillis(앞에서 12자리) + 사용자 ID 뒤 4자리 + automicint(3자리) 메소드를 제공함.
- Long Space.spaceNo 추가 (primitive로 할 경우 기존 데이터 마이그레이션 전이라 error)
- SpaceService에서 create 시에 AtomicInteger 추가
- SpaceViewModel package 위치 변경 및 Assembler에 spaceNo 조립 코드 추가



### 마인드

- 저자
  - 본인 생각에 멋지다고 생각하는 PR을 보냄
- 리뷰어
  - 왜 멋지지 않은지에 대한 장황한 이유를 작성

"In aviation, for example, people who greatly overestimate their level of skills are all dead."

- 코드에 대한 비판을 자신에 대한 비판으로 이해
- 코드 리뷰는
  - 지식 / 공학적 결정을 공유하는 기회
  - 공유(잘 한 것, 아쉬운 것)를 통해 서로의 지식/경험을 나누며 상호 학습을 통한 역량 증대 수단
  - 코드 토의를 개인적 공격으로 받아들이면 물거품
    - 리뷰를 올리지 않거나
    - 코드를 감추려고 하거나
- 생각을 글로 전달하는 것에 대한 어려움
  - 오해의 위험이 큼(음성 톤, 표정의 부재)

- 피드백을 조심스럽게 표현하는 것이 더 중요
  - "You forgot to close the file handle" ->
  - "I can't believe you forgot to close the file handle! You're such an idiot"로 받아들임



### 기법들

- 효율적인 PR 방법



### 효율적인 PR 방법

- 지루한 작업은 컴퓨터로 처리
- 스타일 가이드를 통해 스타일 논쟁을 해소
- PR을 올릴 때 주석 달기
- 모두를 포함하라
- 의미있는 커밋으로 분리



#### 지루한 작업은 컴퓨터로 처리

- 정적 분석은 기계가 더 잘함
- Formatting Tool
  - 공백, 들여쓰기 오류 등
  - 별도의 커밋/PR로 분리. 리뷰 불필요를 기술해서 리뷰를 생략할 수 있도록

- unused import, declaration
  - error로 처리해서 더 빨리 인지할 수 있도록 하는 방법
  - intellij -> Preferences -> inspections > Imports > Unused import > Severity > Error로 변경



#### 스타일 가이드를 통해 스타일 논쟁을 해소

- 좋은 스타일 가이드를 사용
- 조직에서 스타일 가이드를 점진적으로 만들어가면서 사용
- 위 2개를 합쳐서 적절히 사용



#### PR을 올릴 때 주석 달기

- PR를 저자가 먼저 읽어 보고 -> 리뷰어들을 위한 설명을 커멘트로 남겨서 -> 리뷰어들의 시간을 절약할 수 있게 하라



#### 리뷰어에 모두를 포함하라

- 많은 사람이 보면 버그를 더 잘 찾아낼 수 있다.
- 많은 사람이 본다는 것을 알면 사람들은 대개 더 잘하려고는 경향이 있다.



#### 의미있는 커밋으로 분리



##### 혼자하는 코드 리뷰

```
initial commit

1. canCreateGame

2.1 canRoll
2.2 canRoll
2.3 canRoll
2.3.1 canRoll

3.1 gutterGame - add failling test
3.2 gutterGame - make it pass
...
```

한번에 해도 되지만 잘게 나눠놓았다. 그렇게 하면 보는 사람이 편해지고 그 보는 사람 중에 내가 될수도 있다.



### 효율적인 리뷰 방법

- 리뷰는 즉시 시작
- 고수준으로 시작, 저수준으로 내려가라
- 예제 코드 제공에 관대하라
- 리뷰의 범위를 존중하라
- 태그를 활용
- 한 두 등급만 코드 레벨을 올리는 것을 목표



#### 리뷰는 즉시 시작

- 코드 리뷰를 높은 우선순위로
  - 저자를 리뷰 종료될 때까지 대기(Blocked)함
- 리뷰를 바로 시작하면 선순환됨
  - 코드를 읽고 피드백을 줄 때는 시간을 가지고 진행해도 되지만 시작은 바로 해라
  - 이상적으로는 수분 내에
- 리뷰 라운드의 최대 시간은 하루
  - 우선순위 높은 업무로 1일 내 불가하면 다른 리뷰어 지정
  - 월 1회 이상 재지정을 해야한다면 속도를 줄여서 건강한 개발 관습(Practices)을 유지할 수 있어야함
- 처음 리뷰할때는 굉장히 어렵기 때문에 더 자주해야 한다.
  - 리뷰 시간을 확보
    - 매일 아침 30분, 점심 식사 후 30분을 리뷰를 위해 미리 확보  

- 근본적인 문제는 사람들이 리뷰할 시간이 없다고 느낀다는 것임
  - 당신의 개인 기여로만 평가를 받고 있다면, 팀을 돕기 위해 수행하는 모든 일은 시간 낭비처럼 보임
  - 이것은 리뷰를 하는 것의 문제라기보다는 조직적인 문제임

- Pull Requests vs Pair Programming
  - 트레이드오프 : Latency or throughput ?
  - 내성적, 사색, 비동기
  - 외향적, 친밀한 개인적 상호 작용
  - 절대 답은 없음. 앙상블 방식도



https://youtu.be/ssDMIcPBqUE

1:01:23초부터 시작해야함





