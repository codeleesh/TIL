# 엘라스틱서치 CRUD

## 클러스터 탐색

- REST API
  - 노드와 통신하는 방법
  - Elasticsearch는 클러스터와 상호 작용하는데 사용할 수 있는 매우 포괄적이고 강력한 REST API 제공
  - API로 수행할 수 있는 몇 가지 작업
    - 클러스터, 노드 및 색인 상태, 상태 및 통계 확인
    - 클러스터, 노드 및 색인 데이터 및 메타 데이터 관리
    - CRUD 및 인덱스에 대한 검색 작업 수행
    - 페이징, 정렬, 필터링, 스크립팅, 집계 및 기타 여러 고급 검색 작업 실행
  - 웹의 창시자(HTTP) 중의 한 사람인 Roy Fielding의 2000년 논문에 의해서 소개
  - 구성요소 3가지 : 리소스, 메소드, 메시지

## 클러스터 상태

- 클러스터가 어떻게 진행되고 있는지 기본적인 확인
- 우리는 curl을 사용하여 이를 수행
- HTTP/REST 호출을 수행할 수 있는 모든 도구를 사용 가능
- 클러스터 상태를 확인하기 위해 _cat API를 사용
- 녹색 : 모든 것이 좋음(클러스터가 완전히 작동함)
- 노란색 : 모든 데이터를 사용할 수 있지만 일부 복제본은 아직 할당되지 않음(클러스터는 완전히 작동함)
- 빨간색 : 어떤 이유로든 일부 데이터를 사용할 수 없음(클러스터가 부분적으로 작동함)

`GET /_cat/nodes?v`
- `-cat` : node 정보
- `v` : 정보를 보여주기 위한 추가 정보

## 데이터베이스가 가진 데이터 확인하기

- 갖고 있는 모든 인덱스 항목 조회
- index는 일반 RDB에서의 데이터베이스의 역할

`GET /_cat/indices?v`

## 엘라스틱 데이터베이스의 인덱싱 방식

- 책의 색인 검색
- 색인 공간에 저장된 역파일 색인 데이터 구조
- 데이터의 양이 늘어날 수 있음

## HTTP 메서드와 CRUD, SQL을 비교

|HTTP 메서드|CRUD|SQL|
|---------|----|----|
|GET|Read|Select|
|PUT|Update|Update|
|POST|Create|Insert|
|DELETE|Delete|Delete|

## 엘라스틱서치 데이터 처리

- 엘라스틱서치의 데이터 구조
  - 인덱스(index), 타입(type), 도큐먼트(Document)의 단위를 가짐
  - 도큐먼트는 엘라스틱서치의 데이터가 저장되는 최소 단위
  - 여러 개의 도큐먼트는 하나의 타입
  - 다시 여러 개의 타입은 하나의 인덱스로 구성

  |관계형 DB|엘라스틱서치|
  |--------|-------|
  |데이터베이스(Database)|인덱스(Index)|
  |테이블(Table)|타입(Type)|
  |열(Row)|도큐먼트(Document)|
  |행(Column|필드(Field)|
  |스키마|매핑(Mapping)|

## 엘라스틱서치의 질의 방법

- 커맨드라인의 curl 명령어 사용
- postman 응용프로그램 사용
- kibana에서 devtool 사용

## 데이터 입력/조회/삭제/업데이트 요약

|데이터 처리|메서드|구문|
|--------|-----|---|
|입력|PUT|http://localhost:9200/index1/type1/1 -d '{"num":1, "name":"Ilsun Choi"}'|
|조회|GET|http://localhost:9200/index1/type1/1|
|삭제|DELETE|http://localhost:9200/index1/type1/1|
|업데이트|POST|http://localhost:9200/index1/type1/1/_update -d '{doc: {"age":99}}'|
