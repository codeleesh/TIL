# 빅데이터 아키텍처의 종류와 카프카의 미래

## 데이터 레이크 아키텍처와 카프카의 미래 - 초기 빅데이터 플랫폼

- 초기 빅데이터 플랫폼은 엔드 투 엔드로 각 서비스 애플리케이션으로부터 데이터를 배치로 모음
  - 데이터를 배치로 모으는 구조는 유연하지 못했으며 실시간으로 생성되는 데이터들에 대한 인사이트를 서비스 애플리케이션에 빠르게 전달하지 못하는 단점 발생
  - 원천 데이터로부터 파생된 데이터의 히스토리를 파악하기가 어려웠고 계속되는 데이터의 가공으로 인해 데이터가 파편하되면서 데이터 거버넌스(데이터 표준 및 정책)를 지키기 어려웠음

## 데이터 레이크 아키텍처와 카프카의 미래 - 람다 아키텍처

- 3가지 레이어로 나뉨
  - 배치 레이어는 배치 데이터를 모아서 특정 시간, 타이밍마다 일괄 처리
  - 서빙 레이어는 가공된 데이터를 데이터 사용자, 서비스 애플리케이션이 사용할 수 있도록 데이터가 저장된 공간
  - 스피드 레이어는 서비스에서 생성되는 원천 데이터를 실시간으로 분석하는 용도로 사용
- 배치 데이터에 비해 낮은 지연으로 분석이 필요한 경우에 스피드 레이어를 통해 데이터를 분석

## 데이터 레이크 아키텍처와 카프카의 미래 - 람다 아키텍처의 한계

- 데이터를 배치 처리하는 레이어와 실시간 처리하는 레이어를 분리한 람다 아키텍처는 데이터 처리 방식을 명확히 나눌 수 있었지만 레이어가 2개로 나뉘기 때문에 생기는 단점 발생
  - 데이터를 분석, 처리하는 데에 필요한 로직이 2벌로 각각의 레이어에 따로 존재해야 한다는 점과 배치 데이터와 실시간 데이터를 융합하여 처리할 때는 다소 유연하지 못한 파이프라인을 생성해야 한다는 점
  - 1개의 로직을 추상화하여 배치 레이어와 스피드 레이어에 적용하는 형태를 고안한 서밍버드가 있었지만 완벽히 해결되는 것은 아님

## 데이터 레이크 아키텍처와 카프카의 미래 - 카파 아키텍처

- 람다 아키텍처에서 단점으로 부각되었던 로직의 파편화, 디버깅, 배포, 운영 분리에 대한 이슈를 제거하기 위해 배치 레이어를 제거한 카파 아키텍처는 스피드 레이어에서 데이터를 모두 처리할 수 있었으므로 엔지니어들은 더욱 효율적으로 개발과 운영에 임할 수 있음

## 데이터 레이크 아키텍처와 카프카의 미래 - 카파 아키텍처의 활용

- 로그는 배치 데이터를 스트림으로 표현하기에 적합
- 데이터 플랫폼에서 배치 데이터를 표현할 때는 각 시점(시간별, 일자별 등)의 전체 데이터를 백업한 스냅샷 데이터를 뜻함
- 배치 데이터를 로그로 표현할 때는 각 시점의 배치 데이터의 변환 기록(change log)을 시간 순서대로 기록함으로써 각 시점의 모든 스냅샷 데이터를 저장하지 않고도 배치 데이터를 표현 가능
  - 변환 기록 로그에는 `timestamp` 필요

## 배치 데이터와 스트림 데이터

- 배치 데이터
  - 한정된(bounded) 데이터 처리
  - 대규모 배치 데이터를 위한 분산 처리 수행
  - 분, 시간, 일 단위 처리를 위한 지연 발생
  - 복잡한 키 조인 수행
- 스트림 데이터
  - 무한(unbounded) 데이터 처리
  - 지속적으로 들어오는 데이터를 위한 분산 처리 수행
  - 분 단위 이하 지연 발생
  - 단순한 키 조인 수행

## 배치 데이터를 처리하는 방법 (in 하둡)

## 스트림 데이터를 배치로 사용하는 방법

- 스트림 데이터를 배치 데이터로 사용하는 방법은 로그에 시간을 남기는 것
- 로그에 남겨진 시간을 기준으로 데이터를 처리하면 스트림으로 적재된 데이터도 배치로 처리 가능
  - 2021년 신입생 목록을 배치 데이터로 가져오기 위해서 스트림 데이터로 적재된 1월 1일부터 12월 31일까지의 데이터를 구체화된 뷰로 가져온다면 배치로 처리 가능
- 카프카는 로그에 시간을 남기기 때문에 이런 방식의 처리가 가능

## 데이터 레이크 아키텍처와 카프카의 미래 - 스트리밍 데이터 레이크

- 카파 아키텍처에서 서빙 레이어를 제거한 아키텍처인 스트리밍 데이터 레이크를 제안
- 카파 아키텍처를 살펴보면 데이터를 사용하는 고객을 위해 스트림 데이터를 서빙레이어에 저장하는 것을 알수 있음
- 스피드 레이어로 사용되는 카프카에 분석과 프로세싱을 완료한 거대한 용량의 데이터를 오랜 기간 저장하고 사용할 수 있다면 서빙 레이어는 제거되어도 됨
- 서빙 레이어와 스피드 레이어가 이중으로 관리되는 운영 리소스를 줄일 수 있음

## 데이터 레이크 아키텍처와 카프카의 미래 - 스트리밍 데이터 레이크

- 카프카를 스트리밍 데이터 레이크로 사용하기 위해 개선해야 하는 부분
- 자주 접근하지 않는 데이터를 굳이 비싼 자원(브로커의 메모리, 디스크)에 유지할 필요가 없음
- 카프카 클러스터에서 자주 접근하지 않는 데이터는 오브젝트 스토리지와 같이 저렴하면서도 안전한 저장소에 옮겨 저장하고 자주 사용하는 데이터만 브로커에서 사용하는 구분 작업이 필요
- 현재는 사용할 수 없는 방식이나 먼훗날에 가능
