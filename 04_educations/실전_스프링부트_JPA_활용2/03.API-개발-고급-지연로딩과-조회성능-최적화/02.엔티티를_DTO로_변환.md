엔티티를 직접 노출하게 되었을 경우 문제점들이 많았습니다.
  - 양방향 연관관계가 설정된 경우 한 곳은 `@JsonIgnore` 설정해야 합니다.
  - 엔티티 필드가 추가되거나 없어지는 변경 사항이 일어났을 경우 API 스펙이 변경됩니다.
그래서 엔티티를 직접 노출하지 않고 중간에서 데이터를 전달해주는 역할을 하는 `DTO` 를 만들어서 사용합니다.

## 엔티티를 DTO로 변환

- 주문 목록을 조회하는 API는 다음과 같이 엔티티를 직접 응답하도록 설계되어 있습니다.
```java
@GetMapping("/api/v2/simple-orders")
public List<SimpleOrderDto> ordersV2() {
    List<Order> orders = orderRepository.findAllByString(new OrderSearch());
    List<SimpleOrderDto> result = orders.stream()
            .map(SimpleOrderDto::new)
            .collect(toList());

    return result;
}
```

주문, 회원, 배송 엔티티는 다음을 참고해주세요.

## 1.

```java
List<Order> orders = orderRepository.findAllByString(new OrderSearch());
```

```sql
select
    order0_.order_id as order_id1_6_,
    order0_.delivery_id as delivery4_6_,
    order0_.member_id as member_i5_6_,
    order0_.order_date as order_da2_6_,
    order0_.status as status3_6_
from
    orders order0_
inner join
    member member1_
        on order0_.member_id=member1_.member_id limit ?
```

```java
List<SimpleOrderDto> result = orders.stream()
        .map(SimpleOrderDto::new)
        .collect(toList());
```

```java
public SimpleOrderDto(Order order) {
    orderId = order.getId();
    name = order.getMember().getName(); // Lazy 초기화
    orderDate = order.getOrderDate();
    orderStatus = order.getStatus();
    address = order.getDelivery().getAddress(); // Lazy 초기화
}
```
- 영속성 컨텍스트에서 값을 찾고 없으면 쿼리를 실행합니다.

```sql
select
    member0_.member_id as member_i1_4_0_,
    member0_.city as city2_4_0_,
    member0_.street as street3_4_0_,
    member0_.zipcode as zipcode4_4_0_,
    member0_.name as name5_4_0_
from
    member member0_
where
    member0_.member_id in (
        ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?
    )
```

```sql
select
    delivery0_.delivery_id as delivery1_2_0_,
    delivery0_.city as city2_2_0_,
    delivery0_.street as street3_2_0_,
    delivery0_.zipcode as zipcode4_2_0_,
    delivery0_.status as status5_2_0_
from
    delivery delivery0_
where
    delivery0_.delivery_id in (
        ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?
    )
```


- 위와 같이 설정된 상황에서 API를 호출해보면 다음과 같은 에러를 만나게 됩니다.
