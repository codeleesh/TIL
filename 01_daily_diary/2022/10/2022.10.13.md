# 2022.10.13

## 진행한 내용

- 넥스트스텝 TDD, 클린 코드 with Java 15기 시작
	- 자동차레이싱 step5 피드백 진행 중
	- 로또 step4 피드백 진행 중
  - 사다리타기 step2 설계 및 개발 진행 중
- 자동차레이싱 피드백 강의 시청 필요
- 신규 Repository 구성
	- gradle 6.7
	- spring boot 2.7.x
	- jdk 11

## 멀티 모듈의 대한 내용 정리

모듈은 독립적인 의미가 갖는다.
모듈은 어떠한 추상화 정도에 대한 계층을 가지고 있다.
계층 간 의존 관계에 대한 규칙이 있다.

독립 모듈 계층
공통 모듈 계층
도메인 모듈 계층
내부 모듈 계층
어플리케이션 모듈 계층

yaml-importer

Spring Framew그는 하지만 그는 ork 의 EnvironmentPostProcessor Cycle에 특정 path 의 Yaml 기반으로 Configure Property 를 로드하는 기능을 하는 모듈입니다. 이 모듈은 Spring Framework 를 사용하는 어떠한 프로젝트에서도 사용할 수 있습니다. 왜 필요했는지는 아래에서 다시 언급하겠습니다.

독립 모듈 계층

프로젝트 내에서 가장 프로젝트와 성격이 먼 모듈이 이 계층에 위치하게 됩니다. 시스템, 도메인의 비지니스와 전혀 별게로 자체 제작한 라이브러리 같은 모듈이 이 계층으로 들어갈 것이며, 경우에 따라 사내 레파지토리에 올라갈 수도 있을 것 입니다. 특별한 경우가 아니라면 이 계층에 모듈이 생길 일은 거의 없을 것 입니다.
어떠한 모듈도 의존하지 않는다.

공통 모듈 계층

공통 모듈이라니 이게 무슨 소리인가 할 수 있겠지만, 하나의 프로젝트에서 모든 모듈에서 사용될 수 있는 것들은 나올 수 밖에 없었습니다. 그래서 고민 끝에 계층을 정의하였고, 대신에 이 모듈은 가장 큰 제약사항을 두었습니다.

Type, Util 등을 정의한다.
가능하면 사용하지 않는다.
어떠한 모듈도 의존하지 않는다.

도메인 모듈 계층

저장소와 밀접한 중심 도메인을 다루는 계층은 더 견고하고 특별하게 격리되고 관리되어야 하기 때문에 반드시 분리되어야 합니다.

서비스 비지니스를 모른다.
하나의 모듈은 최대 하나의 인프라스트럭처에 대한 책임만 갖는다.
도메인 모듈을 조합한 더 큰 단위의 도메인 모듈이 있을 수 있다.
독립 모듈, 공통 모듈과 의존한다.

다중 인프라스트럭처 사용 모듈

첫번째는 Domain 입니다. Java Class 로 표현된 도메인 Class들이 이곳에 위치합니다. JPA 를 기준으로 한다면 테이블과 맵핑되는 Class 들 입니다. 도메인 모듈 내부에서는 이곳에 위치한 도메인들을 사용하여 대화를 하게 됩니다.

두번째는 Repository 입니다. 도메인의 조회, 저장, 수정, 삭제 역할을 합니다. 여기서 주의할 점은 모든 조회, 저장, 수정, 삭제 역할을 이곳에서 하는 것이 아니라는 점 입니다. 이 모듈은 시스템에서 가장 보호받아야하며 가장 견고해야 할 모듈이므로, 이 모듈에서 조회, 저장, 수정, 삭제 에 대한 정의를 작성할 때 많은 고민을 해야합니다. 예를 들어 Admin Application 에서 시스템 도메인에 대한 통계를 기능을 추가한다고 했을 때를 가정해보겠습니다. 이 때에 통계 조회에 대한 정의는 시스템이 갖는 중심 역할에 따라 달라지게 됩니다. 만들고 있는 시스템에서 통계라는 기능이 중심 역할로 볼 수 있다면 도메인 모듈에 작성할 것이고, 그렇지 않다면 사용을 하는 측에서 작성되어야 합니다. 만일 이 시스템이 주문이라는 중심 도메인을 갖는다면 저는 통계 기능은 사용하는 측(Application Module)에 작성할 것 입니다.

세번째는 Domain Service 입니다. 이 계층은 도메인의 비지니스를 책임집니다. 그렇기 때문에 도메인이 갖는 비지니스가 단순하다면 이 계층은 생기지 않을 수도 있습니다. 이 계층에서 저는 ‘트랜잭션의 단위’를 정의했고, ‘요청 데이터를 검증’ 했으며, ‘이벤트를 발생’하는 일 등 도메인의 비지니스를 작성했습니다.


내부 모듈 계층

저장소, 도메인 외 시스템에서 필요한 모듈들은 이 계층에 속하게 됩니다. 독립 모듈 계층은 시스템에도 전혀 관여되지 않았다면, 이 계층은 시스템과는 연관이 있는 모듈을 말합니다.
이 계층은 시스템 전체적인 기능을 서포트하기 위한 기능 모듈이 만들어질 수 있습니다. 이 계층 역시 프로젝트 안의 어떠한 실행 가능한 어플리케이션에서도 독립 사용 가능한 모듈이 위치되어야 하므로, 도메인 계층을 의존하지 않습니다.
어플리케이션, 도메인 비지니스를 모른다.

core-web

web 설정을 사용하는 프로젝트에서 사용할 수 있는 모듈이다. 주로 Web Filter 를 이용한 보안, 로깅 등으로 활용되며, 웹에 대한 필수적인 공통 설정을 하기도 한다.

xxx-client

외부의 xxx 시스템과 통신을 책임지는 모듈이며 각 외부 시스템별로 따로 모듈을 만들었습니다. 이 모듈은 비지니스와 관계없이 요청과 응답을 할 수 있는 사용성을 제공하고, 요청에 대한 설렁과 스팩을 책임집니다. 어플리케이션 모듈에서는 사용하는 외부 시스템 모듈만 사용하게 됩니다.

xxx-event-publisher

특정 이벤트에 대한 처리를 담당합니다. 여기서 말하는 이벤트는 Spring ApplicationEvent 를 말하며, 이벤트가 발생했을 때 SQS 로 이벤트를 전송하거나, 로그를 남기는 등 특정 행위를 처리합니다. 이 모듈 또한 하고 있는 주요 행위의 범위에 따라 따로 모듈이 생성될 수 있습니다.

어플리케이션 모듈 계층

독립적으로 실행 가능한 어플리케이션 모듈 계층입니다.

xx-app-batch
xx-app-worker
xx-app-internal-api
xx-app-external-api
